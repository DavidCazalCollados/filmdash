<div class= "banner d-flex justify-content-center text-center align-items-center">
  <h2>Select your <br />preferences</h2>
</div>


<%= form_with url: preferences_movies_path, class: "form-height", method: :get do |f| %>
    <div class="section marge-t">
      <h5>Format</h5>
      <div class="d-flex scrolling">
        <div class="radio-space" id="movie-image">
          <%= f.radio_button :format, "movie", id: "movie" %>
          <%= f.label :format, "Movies", for: "movie" %>
        </div>
        <div class="radio-space" id="serie-img">
          <%= f.radio_button :format, "tv_series", id: "tv_series" %>
          <%= f.label :format, "Series", for: "tv_series" %>
        </div>
      </div>
    </div>

    <div class="section mt-4 marge-t-two">
      <h5>Runtime</h5>
      <div class="d-flex scrolling">
        <div class="radio-space" id="onehour-img">
          <%= f.radio_button :runtime, "90", id: '90' %>
          <%= f.label :runtime, "1h30 Max", for: "90" %>
        </div>
        <div class="radio-space" id="twohour-img">
          <%= f.radio_button :runtime, "120", id: '120' %>
          <%= f.label :runtime, "2h Max", for: "120" %>
        </div>
        <div class="radio-space" id="threehour-img">
          <%= f.radio_button :runtime, "180", id: '180' %>
          <%= f.label :format, "3h max", for: "120" %>
        </div>
        <div class="radio-space" id="fourhour-img">
          <%= f.radio_button :runtime, "240", id: '240' %>
          <%= f.label :format, "3h and more", for: "240" %>
        </div>
      </div>
    </div>

    <div class="section mt-4 marge-t-two">
      <h5>Genre</h5>
      <div class="d-flex scrolling">
        <div class="check" id="action-img">
          <%= f.check_box :genre, { multiple: true }, '28', nil %>
          <%= f.label :genre, "Action", for: "genre_28" %>
        </div>
        <div class="check" id="adventure-img">
          <%= f.check_box :genre, { multiple: true }, "12", nil %>
          <%= f.label :genre, "Adventure", for: "genre_12" %>
        </div>
        <div class="check" id="animation-img">
          <%= f.check_box :genre, { multiple: true }, '16', nil %>
          <%= f.label :genre, "Animation", for: "genre_16" %>
        </div>
        <div class="check" id="comedy-img">
          <%= f.check_box :genre, { multiple: true }, '35', nil %>
          <%= f.label :genre, "Comedy", for: "genre_35" %>
        </div>
        <div class="check" id="crime-img">
          <%= f.check_box :genre, { multiple: true }, '80', nil %>
          <%= f.label :genre, "Crime", for: "genre_80" %>
        </div>
        <div class="check" id="docu-img">
          <%= f.check_box :genre, { multiple: true }, '99', nil %>
          <%= f.label :genre, "Documentary", for: "genre_99" %>
        </div>
        <div class="check" id="drama-img">
          <%= f.check_box :genre, { multiple: true }, '18', nil %>
          <%= f.label :genre, "Drama", for: "genre_18" %>
        </div>
        <div class="check" id="family-img">
          <%= f.check_box :genre, { multiple: true }, '10751', nil %>
          <%= f.label :genre, "Family", for: "genre_10751" %>
        </div>
        <div class="check" id="fantasy-img">
          <%= f.check_box :genre, { multiple: true }, '14', nil %>
          <%= f.label :genre, "Fantasy", for: "genre_14" %>
        </div>
        <div class="check" id="history-img">
          <%= f.check_box :genre, { multiple: true }, '36', nil %>
          <%= f.label :genre, "History", for: "genre_36" %>
        </div>
        <div class="check" id="horror-img">
          <%= f.check_box :genre, { multiple: true }, '27', nil %>
          <%= f.label :genre, "Horror", for: "genre_27" %>
        </div>
        <div class="check" id="music-img">
          <%= f.check_box :genre, { multiple: true }, '10402', nil %>
          <%= f.label :genre, "Music", for: "genre_10402" %>
        </div>
        <div class="check" id="mystery-img">
          <%= f.check_box :genre, { multiple: true }, '9648', nil %>
          <%= f.label :genre, "Mystery", for: "genre_9648" %>
        </div>
        <div class="check" id="romance-img">
          <%= f.check_box :genre, { multiple: true }, '10749', nil %>
          <%= f.label :genre, "Romance", for: "genre_10749" %>
        </div>
        <div class="check" id="science-img">
          <%= f.check_box :genre, { multiple: true }, '878', nil %>
          <%= f.label :genre, "Science Fiction", for: "genre_878" %>
        </div>
        <div class="check" id="thriller-img">
          <%= f.check_box :genre, { multiple: true }, '53', nil %>
          <%= f.label :genre, "Thriller", for: "genre_53" %>
        </div>
        <div class="check" id="war-img">
          <%= f.check_box :genre, { multiple: true }, '10752', nil %>
          <%= f.label :genre, "War", for: "genre_10752" %>
        </div>
        <div class="check" id="western-img">
          <%= f.check_box :genre, { multiple: true }, '37', nil %>
          <%= f.label :genre, "Western", for: "genre_37" %>
        </div>
      </div>
    </div>

    <div class="section mt-4 marge-t-two">
      <h5>Period</h5>
      <div class="d-flex scrolling">
        <div class="radio-space" id="thisyear-img">
          <%= f.radio_button :period, "2024-01-01", id: '2024-01-01' %>
          <%= f.label :period, "This year", for: "2024-01-01" %>
        </div>
        <div class="radio-space" id="twenty-twenty-img">
          <%= f.radio_button :period, "2020-01-01", id: '2020-01-01' %>
          <%= f.label :period, "2020's", for: "2020-01-01" %>
        </div>
        <div class="radio-space" id="twenty-ten-img">
          <%= f.radio_button :period, "2010-01-01", id: '2010-01-01' %>
          <%= f.label :period, "2010's", for: "2010-01-01" %>
        </div>
        <div class="radio-space" id="twenty-img">
          <%= f.radio_button :period, "2000-01-01", id: '2000-01-01' %>
          <%= f.label :period, "2000's", for: "2000-01-01" %>
        </div>
        <div class="radio-space" id="nine-nine-img">
          <%= f.radio_button :period, "1990-01-01", id: '1990-01-01' %>
          <%= f.label :period, "1990's", for: "1990-01-01" %>
        </div>
        <div class="radio-space" id="nine-eight-img">
          <%= f.radio_button :period, "1980-01-01", id: '1980-01-01' %>
          <%= f.label :period, "1980's", for: "1980-01-01" %>
        </div>
        <div class="radio-space" id="nine-seven-img">
          <%= f.radio_button :period, "1970-01-01", id: '1970-01-01' %>
          <%= f.label :period, "1970's", for: "1970-01-01" %>
        </div>
        <div class="radio-space" id="nine-six-img">
          <%= f.radio_button :period, "1960-01-01", id: '1960-01-01' %>
          <%= f.label :period, "1960's", for: "1960-01-01" %>
        </div>
        <div class="radio-space" id="nine-five-img">
          <%= f.radio_button :period, "1950-01-01", id: '1950-01-01' %>
          <%= f.label :period, "1950's", for: "1950-01-01" %>
        </div>
        <div class="radio-space" id="nine-four-img">
          <%= f.radio_button :period, "1940-01-01", id: '1940-01-01' %>
          <%= f.label :period, "1940's", for: "1940-01-01" %>
        </div>
        <div class="radio-space" id="nine-three-img">
          <%= f.radio_button :period, "1930-01-01", id: '1930-01-01' %>
          <%= f.label :period, "1930's", for: "1930-01-01" %>
        </div>
        <div class="radio-space" id="nine-two-img">
          <%= f.radio_button :period, "1920-01-01", id: '1920-01-01' %>
          <%= f.label :period, "1920's", for: "1920-01-01" %>
        </div>
      </div>
    </div>

    <div class="text-center mt-4 form-submit">
      <%= f.submit "See my selection", class: "stylish-button" %>
    </div>
<% end %>
  <%# <div class="container mt-4">
    <h5>Format</h5>
  </div> %>
<script>

  document.addEventListener("turbo:load", function () {
    console.log("Turbo rendered");
    const images = document.querySelectorAll(".radio-space");
    const imagesGenre = document.querySelectorAll('.check');
    let laptopDimensions = window.matchMedia("(min-width: 768px)");

    // For format:
    for (let k = 0; k < imagesGenre.length; k++) {
      const idChecked = imagesGenre[k].firstElementChild;

      imagesGenre[k].onclick = function(e) {
        e.preventDefault()
        if (imagesGenre[k].classList.contains('genre-checked')) {
          imagesGenre[k].classList.remove('genre-checked')
          idChecked.checked = false
        } else {
          imagesGenre[k].classList.add('genre-checked')
          idChecked.checked = true
        }
      };

      // Dimension condition
      if (laptopDimensions.matches) {
        imagesGenre[k].onmousedown = (e) => {
          imagesGenre[k].style.transform = 'scale(0.98)'
        };
        imagesGenre[k].onmouseup = (e) => {
          imagesGenre[k].style.transform = 'scale(1.07)'
        };

        imagesGenre[k].onmouseenter = function() {
          const childrenHover = this.parentElement.children;
          for (let b = 0; b < childrenHover.length; b++) {
            if (childrenHover[b] !== imagesGenre[k]) {
              childrenHover[b].style.transform = 'scale(0.98)';
            }
            imagesGenre[k].style.transform = 'scale(1.07)'
          }
        };

        imagesGenre[k].onmouseleave = function(e) {
          const childrenLeave = this.parentElement.children;
          for (let e = 0; e < childrenLeave.length; e++) {
            if (childrenLeave[e] !== imagesGenre[k]) {
              childrenLeave[e].style.transform = 'scale(1)'
            };
          };
          imagesGenre[k].style.transform = 'scale(1)'
        };
      } else {
        imagesGenre[k].ontouchstart = (e) => {
          imagesGenre[k].style.transform = 'scale(0.9)'
        };
        imagesGenre[k].ontouchend = (e) => {
          imagesGenre[k].style.transform = 'scale(1)'
        };
      };
    };

    // For the other criteria:
    for (let i = 0; i < images.length; i++) {
      const id = images[i].firstElementChild;

      images[i].onclick = function(e) {
        e.preventDefault();
        id.checked = !id.checked;
        this.classList.toggle('genre-checked')
        const children = this.parentElement.children;
        for (let j = 0; j < children.length; j++) {
            const firstChild = children[j].firstElementChild
            if (children[j] !== images[i]) {
              children[j].classList.toggle('d-none')
              firstChild.checked = false
            };
        };
      };

      // Dimension condition
      if (laptopDimensions.matches) {
        images[i].onmousedown = () => {
          images[i].style.transform = 'scale(0.98)'
        };
        images[i].onmouseup = () => {
          images[i].style.transform = 'scale(1.07)'
        };

        images[i].onmouseenter = function() {
          const childrenHover = this.parentElement.children;
          for (let b = 0; b < childrenHover.length; b++) {
            if (childrenHover[b] !== images[i]) {
              childrenHover[b].style.transform = 'scale(0.98)';
            }
            images[i].style.transform = 'scale(1.07)'
          }
        };

        images[i].onmouseleave = function(e) {
          const childrenLeave = this.parentElement.children;
          for (let e = 0; e < childrenLeave.length; e++) {
            if (childrenLeave[e] !== images[i]) {
              childrenLeave[e].style.transform = 'scale(1)'
            };
          };
          images[i].style.transform = 'scale(1)'
        };
      };
    };
  });

</script>
